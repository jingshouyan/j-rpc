<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>接口文档</title>
		<link rel="stylesheet" type="text/css" href="assets/bootstrap-3.3.7-dist/css/bootstrap.css"/>
		<link rel="stylesheet" type="text/css" href="assets/fontawesome/css/font-awesome.css"/>
		<link rel="stylesheet" type="text/css" href="css/style.css"/>
		<link rel="stylesheet" type="text/css" href="css/boss.css"/>
		<link rel="stylesheet" type="text/css" href="css/boss-index.css"/>
		<link rel="stylesheet" type="text/css" href="css/interface.css"/>
	</head>
	<body>
		<div class="ore-page" id="ID_PAGE_INDEX">
			<div class="ore-header" ID="HEADER_DIV">
				
			</div>
			<div class="ore-main">
				<div class="ore-main-left" id="ID_MAIN_LEFT">
					
				</div>
				<div class="ore-main-right" id="ID_MAIN_RIGHT">
					
				</div>
			</div><!--E ore-main-->
		</div><!--E ore-page-->
		<div id="ID_TPL_CONTAINER"></div>
		<div id="ID_DIALOG_CONTAINER"></div>
		
		<script src="assets/jquery/jquery-1.12.4.min.js"></script>
		<script type="text/javascript" src="assets/director.min.js"></script>
		<script type="text/javascript" src="assets/template.js"></script>
		<script>
			var vrv = {};
			var $Template = template;
			var servers = {};	 // 服务列表
			var interfaces = {}; // 接口列表
			
			// 模板增加i18n
			template.helper("translate", function(key){
				return key ? key.replace(/\[|\]/g, "") : "";
			});
			var controller = {
				loadServerDetail: function(self, serverName){
					$("#ID_MAIN_RIGHT").empty().hide();
					service.loadTpl("ID_MAIN_RIGHT", "tpl/detail-server.tpl?time=" + (new Date().getTime()), {server: servers[serverName]}, function(){						
						$("#ID_MAIN_RIGHT").fadeIn(500);
					});
				},
				loadInterfaceDetail: function(self, interfaceName){
					var currInterface = interfaces[interfaceName];
					var server = currInterface.server;
					$("#ID_MAIN_RIGHT").empty().hide();
					$(".ore-menu .ore-menu-text").removeClass("oreActive");				
					$(self).addClass("oreActive");
					service.loadTpl("ID_MAIN_RIGHT", "tpl/detail-interface.tpl?time=" + (new Date().getTime()), {inter: currInterface, server: server}, function(){						
						$("#ID_MAIN_RIGHT").fadeIn(500);
					});
				},
				loadInterfaceList: function(self, serverName, domId){
					var currServer = servers[serverName];
					
					if($(self).find(".icon-switchstate").hasClass("icon-unfold")){
						$("#" + domId).siblings(".ore-menu-sub").slideUp(500);
						$(self).find(".icon-switchstate").removeClass("icon-unfold").addClass("icon-fold");
						controller.loadServerDetail(self, serverName);
						return;
					}
					$(self).find(".icon-switchstate").removeClass("icon-fold").addClass("icon-unfold");
					$("#" + domId).siblings(".ore-menu-sub").remove();
					$.get("server/" + serverName, {}, function(res){
						
						var _res = util.isString(res) ? JSON.parse(res): res
						console.log(_res.data);
						currServer.codeInfos = _res.data.codeInfos;
													
						util.each(_res.data.methodInfos, function(item, index){
							item.server = currServer;
							interfaces[item.name] = item;
						});
						$("#" + domId).after($Template("ID_TPL_SUBMENU", {"list": _res.data.methodInfos}));							
						$("#" + domId).siblings(".ore-menu-sub").fadeIn(500);
						
						controller.loadServerDetail(self, serverName); 
					});
				}				
			};
			var util = {
				each: function(list, fn){
					if (!list && !$.isArray(list)) {
						logger.error("list is null or is not array");
						return;
					}
					if (!fn) return;
					if(Array.prototype.forEach){
						list.forEach(function(item, index){
							fn(item, index);
						});
					}else{				
						var sw = false;
						for(var i = 0, len = list.length; i < len; i++){
							sw = fn(list[i], i);
							if(sw) return;
						}
					}
				},
				loadScript: function(url, async, callback){
					var scriptDom = document.createElement("script");
		
					scriptDom.type = "text/javascript";
					scriptDom.src = url;
					scriptDom.async = async;
					scriptDom.onload = scriptDom.onreadystatechange = function(){
						
					　　if(!this.readyState || this.readyState=='loaded' || this.readyState=='complete'){
							if($Util.isFunction(callback))callback();
							scriptDom.onload = scriptDom.onreadystatechange = null;
					　　}
					};
					
					document.body.appendChild(scriptDom);
				},
				compileTpl: function(tplstr, data){
					var _data = data ? data : {};
					
					var $render = $Template.compile(tplstr);
					return $render(_data);
				},
				isString: function(arg){
					return typeof arg === 'string';
				},
				isFunction: function(arg){
					return typeof arg  === 'function';	
				},
				isBoolean: function(arg){
					return typeof arg === 'boolean';	
				},
				isJson: function(arg){
					return typeof(arg) == "object" && Object.prototype.toString.call(arg).toLowerCase() === "[object object]" && !arg.length;
				},
				// 去首尾空格
				trim: function(str){
					return this.isString(str) ? str.replace(/^\s+|\s+$/g, ""): str;
				},
			};
			
			
			var service = {
				loadLeftMenu: function (cb){
					$.ajax({
						type: "GET",
						url: "servers",
						data: {},
						success: function(data){
							var resdata = util.isString(data) ? JSON.parse(data): data;
							cb && cb(resdata);
						}
					});
				},
				loadTpl: function(containerId, url, data, fn){
					var len = arguments.length;
					var _data = {}, _fn;
					for(var i = 0; i < len; i++){
						if(util.isJson(arguments[i])){
							_data = arguments[i];
						}else if(util.isFunction(arguments[i])){
							_fn = arguments[i];
						}
					}
					return $.get(url, function(tpl){
						var _tpl = util.compileTpl(tpl, $.extend(false, {timestamp: new Date().getTime()}, _data));
						try{
							$("#" + containerId).html(_tpl);
							if(_fn) _fn(_tpl);
						}catch(e){
							logger.error("[loadTpl error]" + e + ", url = " + url);
						}
						
					});
				},
				loadCacheTpl: function(containerId, url){
					var len = arguments.length;
					var _data, _fn;
					for(var i = 0; i < len; i++){
						if(util.isJson(arguments[i])){
							_data = arguments[i];
						}else if(util.isFunction(arguments[i])){
							_fn = arguments[i];
						}
					}
					return $.get(url, function(tpl){
						var _tpl = tpl;
						$("#" + containerId).append(_tpl);
						if(_fn) _fn(_tpl);
					});
				}
			};
			$(function(){
				
				service.loadCacheTpl("ID_TPL_CONTAINER", "tpl/menu.tpl", function(tpl){					
					service.loadLeftMenu(function(res){
						console.log(res);
						util.each(res.data, function(item, index){
							servers[item.name] = item;
						});
						$("#ID_MAIN_LEFT").html($Template("ID_TPL_MENU", {"list": res.data}));
						$("#ID_PAGE_INDEX").fadeIn(500);
					});
				});				
			});
			
		</script>
	</body>
</html>
